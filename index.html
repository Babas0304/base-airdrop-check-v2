<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASE Protocol Airdrop Allocation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'base-blue': '#0052FF',
                        'base-dark': '#01111E',
                        'base-light': '#F6F6F6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-thumb {
            background-color: #0052FF;
            border-radius: 20px;
        }
    </style>

    <!-- !!! FARCASTER FRAME META TAGS START HERE !!! -->
    <!-- The image users will see in the feed. Replace the placeholder URL with your actual logo/banner -->
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://placehold.co/1200x630/0052FF/ffffff?text=BASE+Airdrop+Checker" />
    <meta property="fc:frame:post_url" content="https://base-checker-airdrop.vercel.app/" />
    <!-- Button 1: Directs users to the full web app to input their wallet -->
    <meta property="fc:frame:button:1" content="Check Allocation Now" />
    <meta property="fc:frame:button:1:action" content="link" />
    <meta property="fc:frame:button:1:target" content="https://base-checker-airdrop.vercel.app/" />
    <!-- !!! FARCASTER FRAME META TAGS END HERE !!! -->

</head>
<body class="bg-base-dark text-base-light min-h-screen flex items-center justify-center p-4 font-sans">

    <div class="w-full max-w-lg bg-gray-900 p-6 sm:p-8 rounded-2xl shadow-2xl border border-base-blue/50">

        <!-- Header -->
        <header class="text-center mb-8">
            <div class="flex justify-center items-center mb-3">
                <!-- BASE Logo Placeholder (Simple Circle Blue) -->
                <svg class="w-8 h-8 text-base-blue mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.84 8.76l-4.44 4.44c-.19.19-.44.29-.71.29s-.52-.1-.71-.29l-2.22-2.22c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0l1.51 1.51 3.73-3.73c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41z"/></svg>
                <h1 class="text-3xl font-extrabold text-white tracking-tight">BASE Protocol Airdrop Allocation</h1>
            </div>
            <p class="text-gray-400 text-sm">Retrieve and verify your confirmed token allocation using your BASE/ETH Wallet Address.</p>
        </header>

        <!-- Input Section -->
        <div class="mb-6">
            <label for="walletAddress" class="block text-sm font-medium mb-2 text-gray-300">Your BASE/ETH Wallet Address</label>
            <input type="text" id="walletAddress" placeholder="e.g., 0x420000000000000000000000000000000000000X"
                   class="w-full p-3 rounded-lg bg-gray-800 text-white border-2 border-gray-700 focus:border-base-blue focus:ring-base-blue transition duration-200 shadow-inner"
                   maxlength="42">
        </div>

        <!-- Button -->
        <button id="checkButton" onclick="checkAllocation()"
                class="w-full bg-base-blue hover:bg-blue-600 text-white font-bold py-3 rounded-lg transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-base-blue/50 shadow-lg shadow-base-blue/40 flex items-center justify-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c-.544.025-1.085.081-1.623.167M2.4 15.6c.162.247.332.48.513.7l6.613 6.613c.404.404 1.059.404 1.463 0l7.252-7.252a11.955 11.955 0 00.167-1.623L21.056 12A11.955 11.955 0 0012 2.944c-4.97 0-9 4.03-9 9s4.03 9 9 9z"></path></svg>
            <span>Retrieve Allocation Data</span>
        </button>

        <!-- Result Display -->
        <div id="resultBox" class="mt-8 p-4 rounded-xl hidden transition-all duration-500 ease-in-out">
            <p id="resultMessage" class="font-semibold text-center text-lg mb-4"></p>
            <div id="allocationDetails" class="hidden">
                <div class="text-center bg-green-600/20 p-4 rounded-lg mb-4 border border-green-500">
                    <p class="text-green-400 text-sm font-medium uppercase tracking-wider">Confirmed Allocation</p>
                    <p id="allocationDisplay" class="font-extrabold text-white text-5xl mt-1"></p>
                    <p class="text-xs text-gray-300 mt-2">Token amount is final based on indexer snapshots.</p>
                </div>
                <p id="addressDisplay" class="text-xs text-gray-400 text-center break-all">Queried Address: <span class="text-gray-200 font-mono" id="queriedAddress"></span></p>
            </div>
        </div>

        <!-- Footer/Disclaimer -->
        <footer class="mt-8 pt-4 border-t border-gray-800 text-center text-xs text-gray-500">
            <p>Data retrieved from BASE Indexers. Contact support for disputes.</p>
        </footer>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Deterministic Hashing Function ---
        // Used to ensure the same address always produces the same result
        function hashCode(s) {
            let hash = 0;
            if (s.length === 0) return 0;
            for (let i = 0; i < s.length; i++) {
                const char = s.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash |= 0; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }

        // --- Allocation Functions ---
        const BASE_ALLOCATION_MIN = 1000;
        const BASE_ALLOCATION_MAX = 10000;
        const TOKEN_SYMBOL = "$BASE"; 
        const addressInput = document.getElementById('walletAddress');
        const resultBox = document.getElementById('resultBox');
        const resultMessage = document.getElementById('resultMessage');
        const allocationDisplay = document.getElementById('allocationDisplay');
        const allocationDetails = document.getElementById('allocationDetails');
        const queriedAddress = document.getElementById('queriedAddress');
        const checkButton = document.getElementById('checkButton');

        function generateDeterministicAllocation(hash) {
            // Use the hash to generate a consistent base number
            const base = BASE_ALLOCATION_MIN + (hash % (BASE_ALLOCATION_MAX - BASE_ALLOCATION_MIN));
            
            // Apply a bonus based on hash value for variability
            const activityBonus = (hash % 150) * 10; 
            let final = base + activityBonus;

            // Round to the nearest 100 for a clean, official look
            return Math.round(final / 100) * 100;
        }

        function showResult(message, allocation = null, address = null) {
            resultMessage.textContent = message;
            
            // Always success styling
            resultBox.className = `mt-8 p-4 rounded-xl block transition-all duration-500 ease-in-out bg-green-600/20 text-green-400 border border-green-500`;
            
            if (allocation !== null && address !== null) {
                allocationDisplay.textContent = `${allocation.toLocaleString()} ${TOKEN_SYMBOL}`;
                queriedAddress.textContent = address;
                allocationDetails.classList.remove('hidden');
            } else {
                allocationDetails.classList.add('hidden');
            }
        }

        async function checkAllocation() {
            const address = addressInput.value.trim().toLowerCase();
            checkButton.disabled = true;
            checkButton.textContent = "Querying BASE Indexers for Snapshot Data...";
            resultBox.classList.add('hidden'); 

            // 1. Basic Validation (Must be 42 chars and start with 0x)
            if (!address || address.length !== 42 || !address.startsWith('0x')) {
                resultMessage.textContent = "Error: Invalid Wallet Address format. Please ensure it is 42 characters and starts with '0x'.";
                resultBox.className = `mt-8 p-4 rounded-xl block transition-all duration-500 ease-in-out bg-red-600/20 text-red-400 border border-red-500`;
                allocationDetails.classList.add('hidden');
                checkButton.disabled = false;
                checkButton.textContent = "Retrieve Allocation Data";
                return;
            }

            // Simulate Network Delay
            await new Promise(resolve => setTimeout(resolve, 2500)); 

            // 2. Deterministic ALLOCATION Logic (Success-Only)
            const addressHex = address.substring(2);
            const finalHash = hashCode(addressHex);
            
            // Calculate deterministic allocation
            const finalAllocation = generateDeterministicAllocation(finalHash);

            let reason = `Status: CONFIRMED. Allocation based on consistent on-chain activity and early participation metrics.`;

            // Display Result
            showResult(`âœ… ALLOCATION CONFIRMED for ${address}. ${reason}`, finalAllocation, address);

            // Reset button
            checkButton.disabled = false;
            checkButton.textContent = "Retrieve Allocation Data";
        }
    </script>

</body>
</html>
